<?xml version="1.0" encoding="utf-8"?>
<modification>
  <name>Modification Default</name>
  <code>default</code>
  <version>1.1</version>
  <author>CodeEshop</author>
  <link>https://codeeshop.com</link>

  <file path="system/{engine,library}/{action,loader,config}*.php|system/library/language.php">
    <operation error="skip">
      <search>
        <![CDATA[if (is_file($file)) {]]>
      </search>
      <add position="after">
        <![CDATA[$file = modification($file);]]>
      </add>
    </operation>
  </file>
  <file path="system/library/template/template.php">
    <operation error="skip">
      <search>
        <![CDATA[if (isset($file) && is_file($file)) {]]>
      </search>
      <add position="after">
        <![CDATA[$file = modification($file);]]>
      </add>
    </operation>
  </file>
  <file path="system/library/template/twig.php">
    <operation>
      <search>
        <![CDATA[$file = $this->directory . $filename . '.twig';]]>
      </search>
      <add position="after">
        <![CDATA[
          $file = modification($file, '');
        ]]>
      </add>
    </operation>
    <operation>
      <search>
        <![CDATA[$file = substr($file, strlen($this->root) + 1);]]>
      </search>
      <add position="before">
        <![CDATA[
          if (strpos($file, DIR_STORAGE) === false) {
            $this->loader = new \Twig\Loader\FilesystemLoader('/', $this->root);
        ]]>
      </add>
    </operation>
    <operation>
      <search>
        <![CDATA[$file = substr($file, strlen($this->root) + 1);]]>
      </search>
      <add position="after">
        <![CDATA[
          } else {
            $this->loader = new \Twig\Loader\FilesystemLoader('/', DIR_STORAGE);
            $file = substr($file, strlen(DIR_STORAGE));
          }
        ]]>
      </add>
    </operation>
  </file>
</modification>
